@(menus: List[models.cairo.MenuItem], router: List[models.cairo.RouterEntry])(implicit flash:Flash, token: play.filters.csrf.CSRF.Token, companyUser: models.domain.CompanyUser, loggedUser: LoggedUser)

@import helper._

@main("Desktop", s"Welcome ${companyUser.user.username} to your ${companyUser.company.company_name}'s desktop!") {

<!-- Main jumbotron for a primary marketing message or call to action -->
<div class="jumbotron" style="padding-bottom: 0px;">
    <div class="container">
        <div class="row">
            <ul class="nav navbar-nav">
                @for(menu <- menus) {
                    @htmlHelpers.menuItem(menu)
                }
            </ul>
        </div>
    </div>
</div>
<div class="container">
    <div class="row">
        @flash.get("success").map { msg =>
        <div class="alert alert-info">@msg</div>
        }
    </div>

    <div id="header-region"></div>

    <div id="main-region" class="container">
        <p>Here is static content in the web page. You'll notice that it gets replaced by our app as soon as we start it.</p>
    </div>

    <div id="dialog-region"></div>

    <script type="text/template" id="header-template">
        <div class="navbar-inner">
            <div class="container">
                <a class="brand" href="#contacts">Contact manager</a>
                <div class="nav-collapse collapse">
                    <ul class="nav"></ul>
                </div>
            </div>
        </div>
    </script>

</div>

<script>
    $('ul.dropdown-menu').on('click', function(event) {
        // Avoid following the href location when clicking
        event.preventDefault();
        // Avoid having the menu to close when clicking
        event.stopPropagation();
        // If a menu is already open we close it
        $('ul.dropdown-menu [data-toggle=dropdown]').parent().removeClass('open');
        // opening the one you clicked on
        $(this).parent().addClass('open');
    });
</script>

<script src="./client/cairo/config/marionette/regions/dialog.js"></script>
<script src="./client/cairo/cairoApp.js"></script>
<script src="./client/cairo/config/storage/localstorage.js"></script>

@for(routerEntry <- router) {<script src="./client/cairo/modules/@{routerEntry.fileHandler}.js"></script>
}

<script>
Cairo.module("CairoRouterApp", function(CairoRouterApp, Cairo, Backbone, Marionette, $, _){
  CairoRouterApp.Router = Marionette.AppRouter.extend({
    appRoutes: {
      @for(routerEntry <- router) {
        "@{routerEntry.path}":   "@{routerEntry.handlerObject}.@{routerEntry.action}" }
    }
  });

  var API = {
    @for(routerEntry <- router) {
        @{routerEntry.action}@{routerEntry.handlerObject}: function(id){
          CairoRouterApp.@{routerEntry.handlerObject}.Controller.@{routerEntry.action}@{routerEntry.handlerObject}();
          Cairo.execute("set:active:header", "@{routerEntry.handlerObject}");
        } }
  };

  @for(routerEntry <- router) {
  Cairo.on("@{routerEntry.handlerObject}:@{routerEntry.action}", function(){
    Cairo.navigate("@{routerEntry.handlerObject}");
    API.@{routerEntry.action}@{routerEntry.handlerObject}();
  }); }

  Cairo.addInitializer(function(){
    new CairoRouterApp.Router({
      controller: API
    });
  });
});

</script>

}
